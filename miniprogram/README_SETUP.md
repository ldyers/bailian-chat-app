# 百炼AI聊天小程序 - 设置指南

## 网络连接问题解决方案

如果遇到"网络连接失败"的问题，请按照以下步骤操作：

### 1. 确认API服务器正在运行

1. 在电脑上执行 `start_server.bat` 或运行 `python run.py` 命令启动API服务器
2. 确认服务器启动信息中显示的IP地址（例如：`服务器IP地址: 192.168.1.102`）
3. 使用浏览器访问 `http://[IP地址]:8000/health` 测试API服务是否正常响应
   - 例如：`http://192.168.1.102:8000/health`
   - 正常情况应返回：`{"status":"ok","message":"服务正常运行"}`

### 2. 确保小程序中的API地址配置正确

1. 打开 `app.js` 文件
2. 修改 `apiBaseUrl` 为您电脑的实际IP地址：
   ```javascript
   globalData: {
     apiBaseUrl: 'http://192.168.1.102:8000'  // 修改为您电脑的实际IP地址
   }
   ```
3. 保存文件并重新编译小程序

### 3. 确保网络环境正确

1. 确保手机和电脑在**同一个局域网**内
2. 关闭电脑防火墙或添加8000端口的入站规则
3. 如果使用公司网络，可能需要IT部门协助开放端口

### 4. 在小程序中使用测试功能

1. 启动小程序后，点击页面顶部的"测试网络连接"按钮
2. 查看测试结果：
   - 成功：显示"连接成功！服务器状态: ok, IP: http://192.168.1.102:8000"
   - 失败：显示具体错误信息

### 5. 常见错误及解决方案

| 错误信息 | 可能原因 | 解决方法 |
|---------|---------|---------|
| request:fail timeout | 连接超时 | 检查IP地址是否正确，服务器是否运行 |
| request:fail url not in domain list | 域名未配置 | 开发环境下：确保开启"不校验合法域名..." |
| request:fail -102:net::ERR_INTERNET_DISCONNECTED | 网络断开 | 检查WiFi连接状态 |
| request:fail socket error Connection refused | 服务未运行 | 确保API服务器已启动 |

## 微信开发者工具配置

1. 在微信开发者工具中，点击右上角【详情】
2. 在【本地设置】中：
   - 勾选【不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书】
   - 勾选【开启HTTP请求】
3. 每次修改配置后，需要重启开发者工具

## 发布准备

在小程序发布前，需要：

1. 部署API服务到支持HTTPS的服务器
2. 在微信小程序管理后台配置合法域名
3. 修改app.js中的apiBaseUrl为正式服务器HTTPS地址